<!doctype html>
<html lang="no">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quiz</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./style.css" />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3146019535106543"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand" href="#" id="nav-home">Oscar Kvalø Johansen</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="navbar-nav ms-auto">
            <a class="nav-link" href="#" id="nav-quizzes">Quiz</a>
            <a class="nav-link d-none" href="#" id="nav-admin">Admin</a>
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <span id="nav-user-badge">Gjest</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li id="logout-nav-btn" class="d-none">
                  <button class="dropdown-item">Logg ut</button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div class="accent-bar progress"></div>

    <main class="container my-4">
      <!-- Quiz List -->
      <section id="quiz-list-area" class="d-none">
        <div class="row mb-4">
          <div class="col-md-6">
            <h2 class="h4 fw-semibold">Quiz</h2>
          </div>
          <div class="col-md-6 text-end">
            <div class="btn-group" role="group" aria-label="Quiz filters">
              <button
                type="button"
                id="filter-newest"
                class="btn btn-outline-primary btn-sm active"
              >
                Nyeste
              </button>
              <button
                type="button"
                id="filter-top"
                class="btn btn-outline-primary btn-sm"
              >
                Topp
              </button>
            </div>
          </div>
        </div>
        <div id="quiz-list" class="row g-3">
          <div class="col-md-6 col-lg-4">
            <div
              class="card card-elev card-create-quiz"
              id="create-quiz-card"
              style="cursor: pointer; height: 200px"
            >
              <div
                class="card-body d-flex align-items-center justify-content-center"
              >
                <div class="text-center">
                  <div class="display-4 fw-light" style="color: #9ca3af">+</div>
                  <p class="text-muted small">Opprett ny quiz</p>
                </div>
              </div>
            </div>
          </div>
          <!-- Quizzes loaded here -->
        </div>
      </section>

      <!-- Quiz Creation Form -->
      <section id="quiz-create-area" class="d-none">
        <div class="mb-3">
          <button id="back-to-quizzes-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>
        <div class="card card-elev">
          <div class="card-body">
            <h2 class="h4 fw-semibold mb-3">Opprett ny quiz</h2>
            <form id="quiz-create-form" novalidate>
              <div class="mb-3">
                <label for="quiz-title" class="form-label">Tittel</label>
                <input
                  type="text"
                  class="form-control"
                  id="quiz-title"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="quiz-description" class="form-label">
                  Beskrivelse
                </label>
                <textarea
                  class="form-control"
                  id="quiz-description"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3 p-3 bg-light rounded border">
                <label class="form-label small fw-semibold"
                  >Quiz Thumbnail (valgfritt)</label
                >
                <p class="text-muted small mb-2">
                  Velg et bilde som skal vises på quiz-kortet på hovedsiden
                </p>
                <div class="input-group input-group-sm mb-2">
                  <input
                    type="text"
                    class="form-control"
                    id="quiz-thumbnail-search"
                    placeholder="Søk etter bilde (f.eks. 'quiz', 'læring', etc.)..."
                  />
                  <button
                    type="button"
                    class="btn btn-outline-primary"
                    id="quiz-thumbnail-search-btn"
                    title="Søk etter bilder"
                  >
                    Søk
                  </button>
                </div>
                <div class="thumbnail-search-status small text-muted"></div>
                <div class="thumbnail-search-results-container d-none mt-2">
                  <div class="thumbnail-grid"></div>
                </div>
                <div class="selected-thumbnail-display d-none mt-2">
                  <div class="alert alert-info py-2 px-3 mb-0">
                    <small><strong>Valgt thumbnail:</strong></small>
                    <div
                      class="selected-thumbnail-preview mt-2"
                      style="
                        max-width: 150px;
                        max-height: 100px;
                        border-radius: 0.25rem;
                        overflow: hidden;
                      "
                    >
                      <img
                        style="width: 100%; height: 100%; object-fit: cover"
                      />
                    </div>
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-danger remove-thumbnail-btn mt-2"
                    >
                      Fjern thumbnail
                    </button>
                  </div>
                  <input type="hidden" id="quiz-thumbnail-url" />
                </div>
              </div>
              <div id="questions-container" class="mb-3"></div>
              <div class="d-flex gap-2 mb-3">
                <button
                  type="button"
                  id="add-question-btn"
                  class="btn btn-outline-primary"
                >
                  Legg til spørsmål
                </button>
                <button
                  type="button"
                  id="add-movie-rating-btn"
                  class="btn btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#movieRatingModal"
                >
                  Legg til filmrating
                </button>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                  Publiser quiz
                </button>
              </div>
            </form>
            <div id="quiz-create-status" class="mt-3 text-muted small"></div>
          </div>
        </div>
      </section>

      <!-- Quiz Taking Area -->
      <section id="quiz-take-area" class="d-none">
        <div class="mb-3">
          <button id="back-to-quizzes-btn2" class="btn btn-secondary">
            Tilbake
          </button>
        </div>
        <div class="card card-elev">
          <div class="card-body">
            <h2 id="quiz-take-title" class="h4 fw-semibold mb-2"></h2>
            <p id="quiz-take-description" class="text-muted small mb-3"></p>

            <!-- Name input (shown only on first attempt) -->
            <div id="quiz-name-section" class="d-none mb-3">
              <label for="quiz-participant-name" class="form-label"
                >Ditt navn</label
              >
              <p class="text-muted small mb-2">
                Du kan bare skrive navn én gang per quiz. Velg navn med omhu!
              </p>
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="quiz-participant-name"
                  placeholder="Skriv ditt navn..."
                  required
                />
                <button
                  type="button"
                  class="btn btn-primary"
                  id="quiz-name-confirm-btn"
                >
                  Bekreft
                </button>
              </div>
            </div>

            <!-- Quiz form (shown after name is confirmed) -->
            <form id="quiz-take-form" novalidate class="d-none">
              <div id="quiz-questions-container"></div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Send svar</button>
                <button
                  type="button"
                  id="cancel-take-btn"
                  class="btn btn-secondary"
                >
                  Avbryt
                </button>
              </div>
            </form>
            <div id="quiz-take-status" class="mt-3 text-muted small"></div>
          </div>
        </div>
      </section>

      <!-- Results (My answers + answers to my quizzes) -->
      <section id="results-area" class="d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h4 fw-semibold m-0">Resultater</h2>
          <button id="results-back-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>

        <div class="card card-elev mb-3">
          <div class="card-body">
            <h3 class="h5 fw-semibold mb-2">Mine svar</h3>
            <div id="my-results-container"></div>
          </div>
        </div>

        <div id="my-quiz-results-card" class="card card-elev d-none">
          <div class="card-body">
            <h3 class="h5 fw-semibold mb-2">Svar på mine quiz</h3>
            <div id="my-quiz-results-container"></div>
          </div>
        </div>
      </section>

      <!-- Admin Results -->
      <section id="admin-results-area" class="d-none">
        <div class="mb-3">
          <button id="admin-results-back-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>
        <h2 class="h4 fw-semibold mb-4">Svar fra brukere</h2>
        <div id="admin-results-container">
          <!-- Results table loaded here -->
        </div>
      </section>

      <!-- Movie Rating Modal -->
      <div
        class="modal fade"
        id="movieRatingModal"
        tabindex="-1"
        aria-labelledby="movieRatingModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="movieRatingModalLabel">
                Legg til filmrating-spørsmål
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="movie-rating-form">
                <div class="mb-3">
                  <label for="movie-title-input" class="form-label"
                    >Filmtittel</label
                  >
                  <div class="position-relative">
                    <input
                      type="text"
                      class="form-control"
                      id="movie-title-input"
                      placeholder="f.eks. Inception, The Matrix..."
                      required
                      autocomplete="off"
                    />
                    <div
                      id="movie-suggestions-dropdown"
                      class="position-absolute w-100 bg-white border rounded mt-1 d-none"
                      style="
                        top: 100%;
                        z-index: 1000;
                        max-height: 300px;
                        overflow-y: auto;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                      "
                    ></div>
                  </div>
                  <small class="text-muted"
                    >Skriv den engelske filmtittelen for å se forslag</small
                  >
                </div>
                <div class="mb-3">
                  <label class="form-label">Spørsmålstype</label>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="movie-question-type"
                      id="movie-multiple-choice"
                      value="multiple_choice"
                      checked
                    />
                    <label class="form-check-label" for="movie-multiple-choice">
                      Flervalg (4 alternativer)
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="movie-question-type"
                      id="movie-text-answer"
                      value="text"
                    />
                    <label class="form-check-label" for="movie-text-answer">
                      Tekstsvar (±0.2 toleranse)
                    </label>
                  </div>
                </div>
                <div
                  id="movie-rating-status"
                  class="text-muted small mb-2"
                ></div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Avbryt
              </button>
              <button
                type="button"
                id="movie-rating-submit-btn"
                class="btn btn-primary"
              >
                Generer spørsmål
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Movie Rating Edit Modal -->
      <div
        class="modal fade"
        id="movieRatingEditModal"
        tabindex="-1"
        aria-labelledby="movieRatingEditModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="movieRatingEditModalLabel">
                Rediger svaralternativer
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div id="movie-rating-question" class="mb-3 p-2 bg-light rounded">
                <small class="text-muted"><strong>Spørsmål:</strong></small>
                <div id="movie-question-text" class="small mt-1"></div>
              </div>
              <form id="movie-rating-edit-form">
                <div class="mb-3">
                  <label class="form-label small fw-semibold"
                    >Svaralternativer</label
                  >
                  <div id="movie-rating-answers-container"></div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Avbryt
              </button>
              <button
                type="button"
                id="movie-rating-confirm-btn"
                class="btn btn-primary"
              >
                Legg til spørsmål
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./Javascript/quiz-app.js"></script>
  </body>
</html>
