<!doctype html>
<html lang="no">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Lag og ta quiz p√• nett. En moderne plattform for √• teste kunnskap og l√¶re nye ting."
    />
    <meta name="theme-color" content="#2563eb" />
    <title>QuizHub ‚Äì Lag og ta quiz</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./style.css" />
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3146019535106543"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand" href="#" id="nav-home">QuizHub</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="navbar-nav me-auto">
            <a class="nav-link" href="#" id="nav-quizzes">Quiz</a>
            <a class="nav-link" href="#" id="nav-rankings">Rangeringer</a>
            <a class="nav-link d-none" href="#" id="nav-admin">Admin</a>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <span id="nav-user-badge">Gjest</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li id="logout-nav-btn" class="d-none">
                  <button class="dropdown-item">Logg ut</button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div class="accent-bar progress"></div>

    <main class="container my-4">
      <!-- Quiz List -->
      <section id="quiz-list-area" class="d-none">
        <!-- Search and Filters Bar -->
        <div
          class="card card-elev mb-4"
          style="
            background: linear-gradient(
              135deg,
              rgba(255, 214, 2, 0.1),
              rgba(255, 140, 0, 0.1)
            );
          "
        >
          <div class="card-body py-3">
            <div class="row align-items-center">
              <div class="col-md-5 mb-3 mb-md-0">
                <input
                  type="search"
                  class="form-control"
                  placeholder="üîç S√∏k etter quiz..."
                  style="border-radius: 2rem; padding: 0.75rem 1.25rem"
                />
              </div>
              <div class="col-md-7">
                <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                  <button
                    class="btn btn-sm btn-outline-primary active"
                    id="filter-newest"
                  >
                    Nyeste
                  </button>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    id="filter-top"
                  >
                    Topp
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-4 align-items-center">
          <div class="col-md-6">
            <h2 class="h4 fw-semibold mb-0">Quiz Bibliotek</h2>
            <p class="text-muted small mb-0" style="font-weight: 600">
              Velg et quiz eller lag ditt eget!
            </p>
          </div>
          <div class="col-md-6 text-end">
            <div class="btn-group" role="group">
              <button
                class="btn btn-sm btn-outline-secondary active"
                id="view-cards"
              >
                Kort
              </button>
              <button class="btn btn-sm btn-outline-secondary" id="view-list">
                Liste
              </button>
            </div>
          </div>
        </div>
        <div id="quiz-list" class="row g-3">
          <div class="col-md-6 col-lg-4">
            <div
              class="card card-elev card-create-quiz"
              id="create-quiz-card"
              style="cursor: pointer; height: 200px"
            >
              <div
                class="card-body d-flex align-items-center justify-content-center"
              >
                <div class="text-center">
                  <div class="display-4 fw-light" style="color: #9ca3af">+</div>
                  <p class="text-muted small">Opprett ny quiz</p>
                </div>
              </div>
            </div>
          </div>
          <!-- Quizzes loaded here -->
        </div>
      </section>

      <!-- Rankings Section -->
      <section id="rankings-area" class="d-none">
        <div class="mb-4">
          <button id="back-from-rankings-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>

        <div
          class="card card-elev mb-4"
          style="
            background: linear-gradient(
              135deg,
              var(--kahoot-orange),
              var(--kahoot-yellow)
            );
            color: white;
            border: none;
          "
        >
          <div class="card-body text-center py-4">
            <h1 class="display-5 fw-bold mb-2">RANGERINGER</h1>
            <p class="mb-0" style="font-weight: 800; font-size: 1.125rem">
              Se hvem som er best!
            </p>
          </div>
        </div>

        <div class="card card-elev">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="h4 fw-semibold mb-0">Topp Spillere</h2>
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary active">
                  Alle Tider
                </button>
                <button class="btn btn-sm btn-outline-primary">
                  Denne M√•neden
                </button>
                <button class="btn btn-sm btn-outline-primary">
                  Denne Uken
                </button>
              </div>
            </div>

            <div id="rankings-loading" class="text-center py-5">
              <div
                class="spinner-border"
                style="color: var(--kahoot-purple)"
                role="status"
              >
                <span class="visually-hidden">Laster...</span>
              </div>
              <p class="mt-3 fw-bold">Laster rangeringer...</p>
            </div>

            <div id="rankings-list" class="d-none">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th style="width: 80px">#</th>
                      <th>Spiller</th>
                      <th class="text-end">Poeng</th>
                      <th class="text-end">Quiz Spilt</th>
                      <th class="text-end">N√∏yaktighet</th>
                    </tr>
                  </thead>
                  <tbody id="rankings-tbody">
                    <!-- Rankings will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>

            <div id="rankings-error" class="d-none text-center py-5">
              <div style="font-size: 1.5rem; font-weight: bold">!</div>
              <p class="fw-bold mt-3">Kunne ikke laste rangeringer</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Quiz Creation Form -->
      <section id="quiz-create-area" class="d-none">
        <div class="mb-3 d-flex justify-content-between align-items-center">
          <div>
            <button id="back-to-quizzes-btn" class="btn btn-secondary">
              Tilbake
            </button>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary">Lagre Kladd</button>
            <button class="btn btn-outline-secondary">Forh√•ndsvisning</button>
            <button class="btn btn-outline-secondary">Importer</button>
          </div>
        </div>

        <!-- Progress Steps -->
        <div
          class="card card-elev mb-4"
          style="
            background: linear-gradient(
              135deg,
              var(--kahoot-purple),
              var(--kahoot-blue)
            );
            color: white;
            border: none;
          "
        >
          <div class="card-body py-3">
            <div class="d-flex justify-content-between align-items-center">
              <div class="text-center flex-fill">
                <div
                  style="
                    width: 40px;
                    height: 40px;
                    background: white;
                    color: var(--kahoot-purple);
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 900;
                    font-size: 1.2rem;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                  "
                >
                  1
                </div>
                <div class="small mt-2" style="font-weight: 800">Info</div>
              </div>
              <div
                style="
                  height: 3px;
                  background: rgba(255, 255, 255, 0.3);
                  flex: 1;
                  margin: 0 0.5rem;
                "
              ></div>
              <div class="text-center flex-fill">
                <div
                  style="
                    width: 40px;
                    height: 40px;
                    background: rgba(255, 255, 255, 0.3);
                    color: white;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 900;
                    font-size: 1.2rem;
                  "
                >
                  2
                </div>
                <div class="small mt-2" style="font-weight: 800">Sp√∏rsm√•l</div>
              </div>
              <div
                style="
                  height: 3px;
                  background: rgba(255, 255, 255, 0.3);
                  flex: 1;
                  margin: 0 0.5rem;
                "
              ></div>
              <div class="text-center flex-fill">
                <div
                  style="
                    width: 40px;
                    height: 40px;
                    background: rgba(255, 255, 255, 0.3);
                    color: white;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 900;
                    font-size: 1.2rem;
                  "
                >
                  3
                </div>
                <div class="small mt-2" style="font-weight: 800">
                  Innstillinger
                </div>
              </div>
              <div
                style="
                  height: 3px;
                  background: rgba(255, 255, 255, 0.3);
                  flex: 1;
                  margin: 0 0.5rem;
                "
              ></div>
              <div class="text-center flex-fill">
                <div
                  style="
                    width: 40px;
                    height: 40px;
                    background: rgba(255, 255, 255, 0.3);
                    color: white;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 900;
                    font-size: 1.2rem;
                  "
                >
                  4
                </div>
                <div class="small mt-2" style="font-weight: 800">Publiser</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card card-elev">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h2 class="h4 fw-semibold mb-0">Opprett ny quiz</h2>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary">Mal</button>
                <button class="btn btn-sm btn-outline-secondary">
                  AI Hjelp
                </button>
              </div>
            </div>
            <form id="quiz-create-form" novalidate>
              <div class="mb-3">
                <label for="quiz-title" class="form-label">Tittel</label>
                <input
                  type="text"
                  class="form-control"
                  id="quiz-title"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="quiz-description" class="form-label">
                  Beskrivelse
                </label>
                <textarea
                  class="form-control"
                  id="quiz-description"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3 p-3 bg-light rounded border">
                <label class="form-label small fw-semibold"
                  >Quiz Thumbnail (valgfritt)</label
                >
                <p class="text-muted small mb-2">
                  Velg et bilde som skal vises p√• quiz-kortet p√• hovedsiden
                </p>
                <div class="input-group input-group-sm mb-2">
                  <input
                    type="text"
                    class="form-control"
                    id="quiz-thumbnail-search"
                    placeholder="S√∏k etter bilde (f.eks. 'quiz', 'l√¶ring', etc.)..."
                  />
                  <button
                    type="button"
                    class="btn btn-outline-primary"
                    id="quiz-thumbnail-search-btn"
                    title="S√∏k etter bilder"
                  >
                    S√∏k
                  </button>
                </div>
                <div class="thumbnail-search-status small text-muted"></div>
                <div class="thumbnail-search-results-container d-none mt-2">
                  <div class="thumbnail-grid"></div>
                </div>
                <div class="selected-thumbnail-display d-none mt-2">
                  <div class="alert alert-info py-2 px-3 mb-0">
                    <small><strong>Valgt thumbnail:</strong></small>
                    <div
                      class="selected-thumbnail-preview mt-2"
                      style="
                        max-width: 150px;
                        max-height: 100px;
                        border-radius: 0.25rem;
                        overflow: hidden;
                      "
                    >
                      <img
                        style="width: 100%; height: 100%; object-fit: cover"
                      />
                    </div>
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-danger remove-thumbnail-btn mt-2"
                    >
                      Fjern thumbnail
                    </button>
                  </div>
                  <input type="hidden" id="quiz-thumbnail-url" />
                </div>
              </div>
              <div id="questions-container" class="mb-3"></div>
              <div class="d-flex gap-2 mb-3">
                <button
                  type="button"
                  id="add-question-btn"
                  class="btn btn-outline-primary"
                >
                  Legg til sp√∏rsm√•l
                </button>
                <button
                  type="button"
                  id="add-movie-rating-btn"
                  class="btn btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#movieRatingModal"
                >
                  Legg til filmrating
                </button>
              </div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                  Publiser quiz
                </button>
              </div>
            </form>
            <div id="quiz-create-status" class="mt-3 text-muted small"></div>
          </div>
        </div>
      </section>

      <!-- Quiz Taking Area -->
      <section id="quiz-take-area" class="d-none">
        <div class="mb-3">
          <button id="back-to-quizzes-btn2" class="btn btn-secondary">
            Tilbake
          </button>
        </div>
        <div class="card card-elev">
          <div class="card-body">
            <h2 id="quiz-take-title" class="h4 fw-semibold mb-2"></h2>
            <p id="quiz-take-description" class="text-muted small mb-3"></p>

            <!-- Name input (shown only on first attempt) -->
            <div id="quiz-name-section" class="d-none mb-3">
              <label for="quiz-participant-name" class="form-label"
                >Ditt navn</label
              >
              <p class="text-muted small mb-2">
                Du kan bare skrive navn √©n gang per quiz. Velg navn med omhu!
              </p>
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  id="quiz-participant-name"
                  placeholder="Skriv ditt navn..."
                  required
                />
                <button
                  type="button"
                  class="btn btn-primary"
                  id="quiz-name-confirm-btn"
                >
                  Bekreft
                </button>
              </div>
            </div>

            <!-- Quiz form (shown after name is confirmed) -->
            <form id="quiz-take-form" novalidate class="d-none">
              <div id="quiz-questions-container"></div>
              <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">Send svar</button>
                <button
                  type="button"
                  id="cancel-take-btn"
                  class="btn btn-secondary"
                >
                  Avbryt
                </button>
              </div>
            </form>
            <div id="quiz-take-status" class="mt-3 text-muted small"></div>
          </div>
        </div>
      </section>

      <!-- Results (My answers + answers to my quizzes) -->
      <section id="results-area" class="d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h4 fw-semibold m-0">Resultater</h2>
          <button id="results-back-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>

        <div class="card card-elev mb-3">
          <div class="card-body">
            <h3 class="h5 fw-semibold mb-2">Mine svar</h3>
            <div id="my-results-container"></div>
          </div>
        </div>

        <div id="my-quiz-results-card" class="card card-elev d-none">
          <div class="card-body">
            <h3 class="h5 fw-semibold mb-2">Svar p√• mine quiz</h3>
            <div id="my-quiz-results-container"></div>
          </div>
        </div>
      </section>

      <!-- Admin Results -->
      <section id="admin-results-area" class="d-none">
        <div class="mb-3">
          <button id="admin-results-back-btn" class="btn btn-secondary">
            Tilbake
          </button>
        </div>
        <h2 class="h4 fw-semibold mb-4">Svar fra brukere</h2>
        <div id="admin-results-container">
          <!-- Results table loaded here -->
        </div>
      </section>

      <!-- Movie Rating Modal -->
      <div
        class="modal fade"
        id="movieRatingModal"
        tabindex="-1"
        aria-labelledby="movieRatingModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="movieRatingModalLabel">
                Legg til filmrating-sp√∏rsm√•l
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="movie-rating-form">
                <div class="mb-3">
                  <label for="movie-title-input" class="form-label"
                    >Filmtittel</label
                  >
                  <div class="position-relative">
                    <input
                      type="text"
                      class="form-control"
                      id="movie-title-input"
                      placeholder="f.eks. Inception, The Matrix..."
                      required
                      autocomplete="off"
                    />
                    <div
                      id="movie-suggestions-dropdown"
                      class="position-absolute w-100 bg-white border rounded mt-1 d-none"
                      style="
                        top: 100%;
                        z-index: 1000;
                        max-height: 300px;
                        overflow-y: auto;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                      "
                    ></div>
                  </div>
                  <small class="text-muted"
                    >Skriv den engelske filmtittelen for √• se forslag</small
                  >
                </div>
                <div class="mb-3">
                  <label class="form-label">Sp√∏rsm√•lstype</label>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="movie-question-type"
                      id="movie-multiple-choice"
                      value="multiple_choice"
                      checked
                    />
                    <label class="form-check-label" for="movie-multiple-choice">
                      Flervalg (4 alternativer)
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="movie-question-type"
                      id="movie-text-answer"
                      value="text"
                    />
                    <label class="form-check-label" for="movie-text-answer">
                      Tekstsvar (¬±0.2 toleranse)
                    </label>
                  </div>
                </div>
                <div
                  id="movie-rating-status"
                  class="text-muted small mb-2"
                ></div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Avbryt
              </button>
              <button
                type="button"
                id="movie-rating-submit-btn"
                class="btn btn-primary"
              >
                Generer sp√∏rsm√•l
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Movie Rating Edit Modal -->
      <div
        class="modal fade"
        id="movieRatingEditModal"
        tabindex="-1"
        aria-labelledby="movieRatingEditModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="movieRatingEditModalLabel">
                Rediger svaralternativer
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div id="movie-rating-question" class="mb-3 p-2 bg-light rounded">
                <small class="text-muted"><strong>Sp√∏rsm√•l:</strong></small>
                <div id="movie-question-text" class="small mt-1"></div>
              </div>
              <form id="movie-rating-edit-form">
                <div class="mb-3">
                  <label class="form-label small fw-semibold"
                    >Svaralternativer</label
                  >
                  <div id="movie-rating-answers-container"></div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Avbryt
              </button>
              <button
                type="button"
                id="movie-rating-confirm-btn"
                class="btn btn-primary"
              >
                Legg til sp√∏rsm√•l
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./Javascript/quiz-app.js"></script>
  </body>
</html>
